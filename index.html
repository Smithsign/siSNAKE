<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Orange Snake Game</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    body, html {
      width: 100%;
      height: 100%;
      background: #fff7e6;
      overflow: hidden;
    }
    .hidden { display: none; }

    .landing, .form-page, .game-container, .leaderboard, .guide-page {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: #fff7e6;
      padding: 20px;
    }

    h1, h2 {
      color: #ff9900;
      margin-bottom: 20px;
    }

    .form-box {
      background: white;
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      text-align: center;
      width: 100%;
      max-width: 400px;
    }

    .form-box input[type="text"], .form-box input[type="file"] {
      padding: 12px;
      margin-bottom: 15px;
      width: 100%;
      border: 1px solid #ddd;
      border-radius: 10px;
    }

    .form-box button {
      padding: 10px 20px;
      background: #ff9900;
      color: white;
      border: none;
      border-radius: 10px;
      font-weight: bold;
      cursor: pointer;
    }

    #canvas {
      background: repeating-linear-gradient(45deg, #fff2cc 0, #fff2cc 20px, #ffeda1 20px, #ffeda1 40px);
      display: block;
      margin: auto;
      border-radius: 20px;
    }

    .nav-buttons, .end-screen {
      position: absolute;
      top: 10px; left: 10px;
      display: flex;
      gap: 10px;
    }

    .nav-buttons button, .end-screen button {
      padding: 6px 12px;
      background: #ff9900;
      color: white;
      border: none;
      border-radius: 10px;
      font-weight: bold;
    }

    .end-screen {
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: rgba(0,0,0,0.5);
      width: 100%; height: 100%;
    }
  </style>
</head>
<body>
  <div class="landing" id="landing">
    <h1>Welcome to Orange Snake Game üçä</h1>
    <button onclick="goToForm()">Continue</button>
  </div>

  <div class="form-page hidden" id="formPage">
    <div class="form-box">
      <h2>Enter Your Name & Upload Picture</h2>
      <input type="text" id="playerName" placeholder="Enter your name (.SIGN required)" />
      <input type="file" id="playerImage" accept="image/*" />
      <button id="startGameBtn" disabled onclick="prepareGame()">Start the Game</button>
    </div>
  </div>

  <div class="game-container hidden" id="gameContainer">
    <canvas id="canvas" width="400" height="400"></canvas>
    <div class="nav-buttons">
      <button onclick="showLeaderboard()">Leaderboard</button>
      <button onclick="showGuide()">Guide</button>
    </div>
    <div class="end-screen hidden" id="endScreen">
      <h2>Game Over!</h2>
      <p id="finalScore"></p>
      <button onclick="shareToX()">Share to X</button>
      <button onclick="tryAgain()">Try Again</button>
    </div>
  </div>

  <div class="leaderboard hidden" id="leaderboard">
    <h2>Leaderboard üèÜ</h2>
    <div id="topScores"></div>
    <button onclick="goBackToGame()">Back to Game</button>
  </div>

  <div class="guide-page hidden" id="guidePage">
    <h2>Guide üìñ</h2>
    <p>- Use WASD or Arrow Keys to move</p>
    <p>- Eat üçä to grow and score</p>
    <p>- Your snake gets faster as it grows!</p>
    <button onclick="goBackToGame()">Back to Game</button>
  </div>

  <script>
    let playerData = {}, canvas, ctx, snake = [], food = {}, direction = 'RIGHT', score = 0, speed = 100;
    const imgHead = new Image();
    imgHead.src = 'xin.jpg';
    const orangeImg = new Image();
    orangeImg.src = 'https://img.icons8.com/emoji/48/orange-emoji.png';

    const landing = document.getElementById('landing');
    const formPage = document.getElementById('formPage');
    const gameContainer = document.getElementById('gameContainer');
    const leaderboard = document.getElementById('leaderboard');
    const guidePage = document.getElementById('guidePage');
    const startBtn = document.getElementById('startGameBtn');

    document.getElementById('playerName').addEventListener('input', checkInput);
    document.getElementById('playerImage').addEventListener('change', checkInput);

    function checkInput() {
      const name = document.getElementById('playerName').value;
      const file = document.getElementById('playerImage').files[0];
      startBtn.disabled = !(name.includes('.SIGN') && file);
    }

    function goToForm() {
      landing.classList.add('hidden');
      formPage.classList.remove('hidden');
    }

    function prepareGame() {
      const name = document.getElementById('playerName').value;
      const image = URL.createObjectURL(document.getElementById('playerImage').files[0]);
      playerData = { name, image };
      formPage.classList.add('hidden');
      gameContainer.classList.remove('hidden');
      countdownAndStart();
    }

    function countdownAndStart() {
      let count = 3;
      const countDiv = document.createElement('div');
      countDiv.style.position = 'absolute';
      countDiv.style.fontSize = '48px';
      countDiv.style.color = '#ff9900';
      countDiv.style.top = '50%';
      countDiv.style.left = '50%';
      countDiv.style.transform = 'translate(-50%, -50%)';
      gameContainer.appendChild(countDiv);
      const interval = setInterval(() => {
        if (count === 0) {
          countDiv.remove();
          clearInterval(interval);
          initGame();
        } else {
          countDiv.textContent = count--;
        }
      }, 1000);
    }

    function initGame() {
      canvas = document.getElementById('canvas');
      ctx = canvas.getContext('2d');
      document.addEventListener('keydown', changeDirection);
      snake = [{ x: 160, y: 160 }];
      direction = 'RIGHT';
      score = 0;
      speed = 100;
      placeFood();
      gameLoop();
    }

    function placeFood() {
      food = {
        x: Math.floor(Math.random() * 20) * 20,
        y: Math.floor(Math.random() * 20) * 20,
      };
    }

    function changeDirection(e) {
      const key = e.key;
      if (["ArrowUp", "w"].includes(key) && direction !== 'DOWN') direction = 'UP';
      if (["ArrowDown", "s"].includes(key) && direction !== 'UP') direction = 'DOWN';
      if (["ArrowLeft", "a"].includes(key) && direction !== 'RIGHT') direction = 'LEFT';
      if (["ArrowRight", "d"].includes(key) && direction !== 'LEFT') direction = 'RIGHT';
    }

    function gameLoop() {
      let head = { ...snake[0] };
      if (direction === 'UP') head.y -= 20;
      if (direction === 'DOWN') head.y += 20;
      if (direction === 'LEFT') head.x -= 20;
      if (direction === 'RIGHT') head.x += 20;

      if (head.x < 0 || head.y < 0 || head.x >= 400 || head.y >= 400 || snake.some(seg => seg.x === head.x && seg.y === head.y)) {
        return endGame();
      }

      snake.unshift(head);

      if (head.x === food.x && head.y === food.y) {
        score++;
        speed = Math.max(40, speed - 5);
        placeFood();
      } else {
        snake.pop();
      }

      ctx.clearRect(0, 0, canvas.width, canvas.height);
      snake.forEach((seg, i) => {
        ctx.beginPath();
        ctx.fillStyle = '#000';
        ctx.arc(seg.x + 10, seg.y + 10, 10, 0, Math.PI * 2);
        ctx.fill();
        if (i === 0) ctx.drawImage(imgHead, seg.x, seg.y, 20, 20);
      });
      ctx.drawImage(orangeImg, food.x, food.y, 20, 20);

      setTimeout(gameLoop, speed);
    }

    function endGame() {
      document.getElementById('endScreen').classList.remove('hidden');
      document.getElementById('finalScore').textContent = `${playerData.name} scored ${score} ORANGES üçä`;
      saveToLeaderboard();
    }

    function saveToLeaderboard() {
      const scores = JSON.parse(localStorage.getItem('snakeScores') || '[]');
      scores.push({ ...playerData, score });
      localStorage.setItem('snakeScores', JSON.stringify(scores.sort((a,b)=>b.score-a.score).slice(0, 3)));
    }

    function tryAgain() {
      document.getElementById('endScreen').classList.add('hidden');
      initGame();
    }

    function showLeaderboard() {
      gameContainer.classList.add('hidden');
      leaderboard.classList.remove('hidden');
      const scores = JSON.parse(localStorage.getItem('snakeScores') || '[]');
      document.getElementById('topScores').innerHTML = scores.map((p,i)=>`<div><img src="${p.image}" width="50" style="border-radius:50%"> ü•á${i+1}. ${p.name}: ${p.score} üçä</div>`).join('');
    }

    function showGuide() {
      gameContainer.classList.add('hidden');
      guidePage.classList.remove('hidden');
    }

    function goBackToGame() {
      leaderboard.classList.add('hidden');
      guidePage.classList.add('hidden');
      gameContainer.classList.remove('hidden');
    }

    function shareToX() {
      const tweet = `I just scored ${score} ORANGES üçä in the Orange Snake Game! #OrangeSnakeGame`;
      const url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(tweet)}`;
      window.open(url, '_blank');
    }
  </script>
</body>
</html>
